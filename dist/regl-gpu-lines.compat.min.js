!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n="undefined"!=typeof globalThis?globalThis:n||self).reglLines=e()}(this,(function(){"use strict";function n(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function e(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?n(Object(o),!0).forEach((function(n){t(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function t(n,e,t){return(e=function(n){var e=function(n,e){if("object"!=typeof n||null===n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(n)}(n,"string");return"symbol"==typeof e?e:String(e)}(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function r(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var r,o,i,a,s=[],c=!0,f=!1;try{if(i=(t=t.call(n)).next,0===e){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=i.call(t)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(n){f=!0,o=n}finally{try{if(!c&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(f)throw o}}return s}}(n,e)||i(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable,non-array objects must have a [Symbol.iterator]()method.")}()}function o(n){return function(n){if(Array.isArray(n))return a(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||i(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable,non-array objects must have a [Symbol.iterator]()method.")}()}function i(n,e){if(n){if("string"==typeof n)return a(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(n,e):void 0}}function a(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function s(n,e){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=i(n))||e&&n&&"number"==typeof n.length){t&&(n=t);var r=0,o=function(){};return{s:o,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable,non-array objects must have a [Symbol.iterator]()method.")}var a,s=!0,c=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return s=n.done,n},e:function(n){c=!0,a=n},f:function(){try{s||null==t.return||t.return()}finally{if(c)throw a}}}}var c={CAP_START:0,CAP_END:1,CAP_SHORT:2},f=c,u=function(n,t,r,i,a,c,u,p,l,d,v,m){var h=t?p:u,y=["B","C","D"];t||y.unshift("A");var b={},g={},C=l.concat(h.attrs);if(i){g.vao=n.prop("vao");for(var w=0;w<C.length;w++)b[C[w].name]=w}else{var A,x=s(C);try{for(x.s();!(A=x.n()).done;){var B=A.value;b[B.name]=B.spec}}catch(n){x.e(n)}finally{x.f()}}var _=r?t?function(n){return[n.capRes2,Math.max(n.capRes2,n.joinRes2)]}:function(n){return[Math.max(n.capRes2,n.joinRes2),Math.max(n.capRes2,n.joinRes2)]}:t?function(n){return[n.capRes2,n.joinRes2]}:function(n){return[n.joinRes2,n.joinRes2]};return n(e(e({vert:"".concat(a.glsl,"\nconst float CAP_START=").concat(f.CAP_START,".0;const float CAP_END=").concat(f.CAP_END,".0;").concat(h.glsl,"\nattribute float index;").concat(m?"attribute float debugInstanceID;":"","\nuniform bool _isRound;uniform vec2 _vertCnt2,_capJoinRes2;uniform vec2 _resolution,_capScale;uniform float _miterLimit;").concat(a.orientation||!t?"":"uniform float _orientation;","\nvarying vec3 lineCoord;").concat(m?"varying vec2 triStripCoord;":"","\n").concat(m?"varying float instanceID;":"","\n").concat(m?"varying float vertexIndex;":"","\nbool isnan(float val){return(val<0.0||0.0<val||val==0.0)?false:true;}bool invalid(vec4 p){return p.w==0.0||isnan(p.x);}void main(){const float pi=3.141592653589793;").concat(m?"vertexIndex=index;":"","\nlineCoord=vec3(0);").concat(m?"instanceID=".concat(t?"-1.0":"debugInstanceID",";"):"","\n").concat(m?"triStripCoord=vec2(floor(index/2.0),mod(index,2.0));":"","\n").concat(y.map((function(n){return"vec4 p".concat(n,"=").concat(a.position.generate(a,n),";")})).join("\n"),"\ngl_Position=pB;bool aInvalid=").concat(t?"false":"invalid(pA)",";bool bInvalid=invalid(pB);bool cInvalid=invalid(pC);bool dInvalid=invalid(pD);vec2 v=_vertCnt2+3.0;float N=dot(v,vec2(1));bool mirror=index>=v.x;").concat(t?"if(dInvalid && mirror)return;":"","\nfloat pw=mirror?pC.w:pB.w;").concat(y.map((function(n){return"p".concat(n,"=vec4(vec3(p").concat(n,".xy*_resolution,p").concat(n,".z)/p").concat(n,".w,1);")})).join("\n"),"\n").concat(t?"vec4 pA=pC;":"","\nif(bInvalid||cInvalid||max(abs(pB.z),abs(pC.z))>1.0)return;if(mirror){vec4 vTmp=pC; pC=pB; pB=vTmp;vTmp=pD; pD=pA; pA=vTmp;bool bTmp=dInvalid; dInvalid=aInvalid; aInvalid=bTmp;}").concat(t?"bool isCap=!mirror;":"".concat(r?"":"const ","bool isCap=false"),";if(aInvalid){ ").concat(r?"pA=pC; isCap=true;":"pA=2.0*pB-pC;"," }if(dInvalid){ ").concat(r?"pD=pB;":"pD=2.0*pC-pB;"," }bool roundOrCap=_isRound||isCap;float width=mirror?").concat(a.width.generate(a,"C"),":").concat(a.width.generate(a,"B"),";vec2 tBC=pC.xy-pB.xy;float lBC=length(tBC);tBC/=lBC;vec2 nBC=vec2(-tBC.y,tBC.x);vec2 tAB=pB.xy-pA.xy;float lAB=length(tAB);if(lAB>0.0)tAB/=lAB;vec2 nAB=vec2(-tAB.y,tAB.x);vec2 tCD=pD.xy-pC.xy;float lCD=length(tCD);if(lCD>0.0)tCD/=lCD;vec2 nCD=vec2(-tCD.y,tCD.x);float cosB=clamp(dot(tAB,tBC),-1.0,1.0);const float tol=1e-4;float mirrorSign=mirror?-1.0:1.0;float dirB=-dot(tBC,nAB);float dirC=dot(tBC,nCD);bool bCollinear=abs(dirB)<tol;bool cCollinear=abs(dirC)<tol;bool bIsHairpin=bCollinear && cosB<0.0;dirB=bCollinear?-mirrorSign:sign(dirB);dirC=cCollinear?-mirrorSign:sign(dirC);vec2 miter=bIsHairpin?-tBC:0.5*(nAB+nBC)*dirB;//Compute our primary \"join index\",that is,the index starting at the very first point of the join.\nfloat i=mirror?N-index:index;float res=(isCap?_capJoinRes2.x:_capJoinRes2.y);i-=max(0.0,(mirror?_vertCnt2.y:_vertCnt2.x)-res);i+=(dirB<0.0?-1.0:0.0);i-=mirror?1.0:0.0;i=max(0.0,i);vec2 xBasis=tBC;vec2 yBasis=nBC*dirB;vec2 xy=vec2(0);lineCoord.y=dirB*mirrorSign;if(i==res+1.0){float m=cosB>-0.9999?(tAB.x*tBC.y-tAB.y*tBC.x)/(1.0+cosB):0.0;xy=vec2(min(abs(m),min(lBC,lAB)/width),-1);lineCoord.y=-lineCoord.y;} else {float m2=dot(miter,miter);float lm=sqrt(m2);yBasis=miter/lm;xBasis=dirB*vec2(yBasis.y,-yBasis.x);bool isBevel=1.0>_miterLimit*m2;if(mod(i,2.0)==0.0){if(roundOrCap||i !=0.0){float theta=-0.5*(acos(cosB)*(clamp(i,0.0,res)/res)-pi)*(isCap?2.0:1.0);xy=vec2(cos(theta),sin(theta));if(isCap){if(xy.y>0.001)xy*=_capScale;lineCoord.xy=xy.yx*lineCoord.y;}} else {yBasis=bIsHairpin?vec2(0):miter;xy.y=isBevel?1.0:1.0/m2;}} else {lineCoord.y=0.0;if(isBevel && !roundOrCap){xy.y=-1.0+sqrt((1.0+cosB)*0.5);}}}").concat(t?"float _orientation=".concat(a.orientation?a.orientation.generate(a,""):"mod(_orientation,2.0)",";"):"",";").concat(t?"if(_orientation==CAP_END)lineCoord.xy=-lineCoord.xy;":"","\nvec2 dP=mat2(xBasis,yBasis)*xy;float dx=dot(dP,tBC)*mirrorSign;float useC=(mirror?1.0:0.0)+dx*(width/lBC);lineCoord.z=useC<0.0||useC>1.0?1.0:0.0;").concat(o(a.varyings.values()).map((function(n){return n.generate(a,"useC","B","C")})).join("\n"),"\ngl_Position=pB;gl_Position.xy+=width*dP;gl_Position.xy/=_resolution;gl_Position*=pw;").concat(a.postproject?"gl_Position=".concat(a.postproject,"(gl_Position);"):"","\n}"),frag:c,attributes:b,uniforms:e(e({},v),{},{_vertCnt2:function(n,e){return _(e)},_capJoinRes2:function(n,e){return[e.capRes2,e.joinRes2]},_miterLimit:function(n,e){return e.miterLimit*e.miterLimit},_orientation:n.prop("orientation"),_capScale:n.prop("capScale"),_isRound:function(n,e){return"round"===e.join},_resolution:function(n,e){return e.viewportSize||[n.viewportWidth,n.viewportHeight]}}),primitive:"triangle strip",instances:t?function(n,e){return e.instances*(e.splitCaps?e.orientation===f.CAP_START?Math.ceil(e.count/2):Math.floor(e.count/2):e.count)}:function(n,e){return e.instances*(e.count-3)},count:function(n,e){var t=_(e);return 6+(t[0]+t[1])}},d),g))};var p={NONE:0,REGULAR:1,EXTENDED:2,PER_INSTANCE:4},l=p,d=function(n){for(var t=[],r=n.split("\n"),o=0;o<r.length;o++)r[o]=r[o].replace(v,(function(n,e){return t.push(C(e)),""}));return e({glsl:r.join("\n").trim()},function(n){var e,t,r,o,i,a=new Map,c=new Map,f=s(n);try{for(f.s();!(t=f.n()).done;){var u=t.value;"attribute"===u.type?(a.set(u.name,u),u.vertexUsage=l.NONE,u.endpointUsage=l.NONE):"varying"===u.type?c.set(u.name,u):"postproject"===u.type&&(e=u.name)}}catch(n){f.e(n)}finally{f.f()}var p,d=s(n);try{for(d.s();!(p=d.n()).done;){var v=p.value;if("property"===v.type){switch(v.property){case"width":if(r)throw new Error('Unexpected duplicate pragma for property "'.concat(v.property,'"'));r=v;break;case"position":if(o)throw new Error('Unexpected duplicate pragma for property "'.concat(v.property,'"'));o=v;break;case"orientation":if(i)throw new Error('Unexpected duplicate pragma for property "'.concat(v.property,'"'));i=v;break;default:throw new Error('Invalid pragma property "'.concat(v.property,'"'))}var m,h=s(v.inputs);try{for(h.s();!(m=h.n()).done;){var y=m.value;if(!a.has(y))throw new Error("Missing attribute ".concat(y," of property ").concat(v.property))}}catch(n){h.e(n)}finally{h.f()}}}}catch(n){d.e(n)}finally{d.f()}var b,g=s(n);try{for(g.s();!(b=g.n()).done;){var C=b.value;if(C.inputs){var w,A=s(C.inputs);try{for(A.s();!(w=A.n()).done;){var x=w.value,B=a.get(x);B.isInstanceAttr?(B.vertexUsage=l.PER_INSTANCE,B.endpointUsage=l.PER_INSTANCE):"property"!==C.type&&"varying"!==C.type||("position"===C.property?(B.vertexUsage|=l.EXTENDED,B.endpointUsage|=l.EXTENDED):"orientation"===C.property?B.endpointUsage|=l.PER_INSTANCE:(B.endpointUsage|=l.REGULAR,B.vertexUsage|=l.REGULAR))}}catch(n){A.e(n)}finally{A.f()}}}}catch(n){g.e(n)}finally{g.f()}return{varyings:c,attrs:a,width:r,position:o,orientation:i,postproject:e}}(t))},v=/^\s*#pragma\s+lines\s*:\s*([^;]*);?$/i,m=/^\s*(?:(instance)?)\s*attribute\s+(float|vec2|vec3|vec4)\s+([\w\d_]+)\s*$/i,h=/^\s*(position|width|orientation)\s+=\s+([\w\d_]+)\s*\(([^)]*)\)\s*$/i,y=/^\s*(?:(extrapolate)?)\s*varying\s+(float|vec2|vec3|vec4)\s+([\w\d_]+)\s*=\s*([\w\d_]+)\(([^)]*)\)\s*$/,b=/^\s*postproject\s+=\s+([\w\d_]+)\s*$/i,g={float:1,vec2:2,vec3:3,vec4:4};function C(n){var e;if(e=(n=n.trim()).match(m)){var t=!!e[1];return{type:"attribute",dimension:g[e[2]],name:e[3],isInstanceAttr:t}}if(e=n.match(h)){var r=e[1],o={width:"float",position:"vec4",orientation:"bool"}[r],i=e[2],a=e[3].split(",").map((function(n){return n.trim()})).filter((function(n){return!!n}));return{type:"property",property:r,returnType:o,name:i,inputs:a,generate:function(n,e,t){return"".concat(i,"(").concat(a.map((function(r){return n.attrs.get(r).isInstanceAttr?r:(t||"")+r+e})).join(","),")")}}}if(e=n.match(y)){var s="extrapolate"===e[1],c=e[2],f=e[3],u=e[4],p=e[5].split(",").map((function(n){return n.trim()})).filter((function(n){return!!n}));return{type:"varying",returnType:c,name:f,getter:u,inputs:p,generate:function(n,e,t,r){var o=s?e:"clamp(".concat(e,",0.0,1.0)");return"".concat(f,"=").concat(u,"(").concat(p.map((function(n){return"mix(".concat(n+t,",").concat(n+r,",").concat(o,")")})).join(","),");")}}}if(e=n.match(b))return{type:"postproject",name:e[1]};throw new Error('Unrecognized lines pragma:"'.concat(n,'"'))}var w=[];w[5120]=1,w[5122]=2,w[5124]=4,w[5121]=1,w[5123]=2,w[5125]=4,w[5126]=4;var A={int8:5120,uint8:5121,int16:5122,uint16:5123,int32:5124,uint32:5125,float:5126,float32:5126},x=function(n,e,t){var o={};if(!e)return o;var i,a=s(n.attrs);try{for(a.s();!(i=a.n()).done;){var c=r(i.value,2),f=c[0],u=c[1],p=e[f];if(t?u.endpointUsage:u.vertexUsage){var l={buffer:null,dimension:u.dimension,offset:0,type:NaN,stride:NaN,divisor:1,normalized:!1,bytesPerElement:NaN};if(!p)throw new Error("Missing buffer for ".concat(t?"endpoint":"vertex"," attribute '").concat(f,"'"));if("buffer"===p._reglType)l.buffer=p,l.type=l.buffer._buffer.dtype;else{if(!p.buffer||"buffer"!==p.buffer._reglType)throw new Error("Invalid buffer for attribute '".concat(f,"'. Be sure to wrap in regl.buffer()."));if(l.buffer=p.buffer,E(p,"dimension")&&p.dimension!==l.dimension)throw new Error("Size of attribute(".concat(p.dimension,")does not match dimension specified in shader pragma(").concat(u.dimension,")"));E(p,"offset")&&(l.offset=p.offset),E(p,"type")?l.type=_[p.type]:l.type=l.buffer._buffer.dtype,E(p,"divisor")&&(l.divisor=p.divisor),E(p,"normalized")&&(l.normalized=!!p.normalized),E(p,"stride")&&(l.stride=p.stride)}l.bytesPerElement=B[l.type],Number.isNaN(l.stride)&&(l.stride=l.bytesPerElement*u.dimension),o[f]=l}}}catch(n){a.e(n)}finally{a.f()}return o},B=w,_=A;function E(n,e){return Object.prototype.hasOwnProperty.call(n,e)}var j=[];j[1]="float",j[2]="vec2",j[3]="vec3",j[4]="vec4";var I=function(n,e,t){var r=t?["B","C","D"]:["A","B","C","D"],o=[],i=[];return n.attrs.forEach((function(n,e){var a=t?n.endpointUsage:n.vertexUsage;if(a){var s=[];if(a&D.PER_INSTANCE&&u(0,""),a&D.REGULAR||a&D.EXTENDED)for(var c=0;c<r.length;c++){var f=r[c];(a&D.EXTENDED||"D"!==f&&"A"!==f)&&u(c,f)}o.push("attribute ".concat(S[n.dimension]," ").concat(s.join(","),";"))}function u(r,o){var c=e+o;if(s.push(c),t){var f=a&D.PER_INSTANCE?1:3;i.push({name:c,spec:{buffer:function(n,t){return t.buffers[e].buffer},offset:n.isInstanceAttr?function(n,t){return t.buffers[e].offset+t.buffers[e].stride*r}:function(n,t){return t.buffers[e].offset+t.buffers[e].stride*((t.orientation!==P.CAP_START&&t.splitCaps?3:0)+r)},stride:function(n,t){return t.buffers[e].stride*f*(t.splitCaps?2:1)},divisor:function(t,r){return(n.isInstanceAttr?1:r.instances)*r.buffers[e].divisor},normalized:function(n,t){return void 0!==t.buffers[e].normalized&&t.buffers[e].normalized},type:function(n,t){var r=t.buffers[e];return R.get(void 0===r.type?r.buffer._buffer.dtype:r.type)}}})}else i.push({name:c,spec:{buffer:function(n,t){return t.buffers[e].buffer},offset:function(n,t){return t.buffers[e].offset+t.buffers[e].stride*r},stride:function(n,t){return t.buffers[e].stride},divisor:function(t,r){return(n.isInstanceAttr?1:r.instances)*r.buffers[e].divisor},normalized:function(n,t){return void 0!==t.buffers[e].normalized&&t.buffers[e].normalized},type:function(n,t){var r=t.buffers[e];return R.get(void 0===r.type?r.buffer._buffer.dtype:r.type)}}})}})),n.varyings.forEach((function(n,e){o.push("varying ".concat(n.returnType," ").concat(e,";"))})),{glsl:o.join("\n"),attrs:i}},D=p,T=A,S=j,P=c,R=new Map(Object.entries(T).map((function(n){return n.reverse()})));var N=u,O=d,M=x,k=I,U=function(n,e,t){return function(r){if(!r)return t;if(-1===e.indexOf(r))throw new Error("Invalid ".concat(n," type. Valid options are:").concat(e.join(","),"."));return r}},z=c,L=Y;Y.CAP_START=z.CAP_START,Y.CAP_END=z.CAP_END;var q=new Set(["attributes","elements"]),G=["round","bevel","miter"],H=["round","square","none"],$=[1,1],X=[2,2/Math.sqrt(3)],J=32,V=16384,W=1,F=2,K=4;function Q(n,e,t){return(n?W:0)+(e?F:0)+(t?K:0)}function Y(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!n.hasExtension("ANGLE_instanced_arrays"))throw new Error("regl-gpu-lines requries the ANGLE_instanced_arrays extension");var i=t.vert,a=void 0===i?null:i,c=t.frag,f=void 0===c?null:c,u=t.debug,p=void 0!==u&&u,l=t.reorder,d=void 0!==l&&l;n._gpuLinesCache||(n._gpuLinesCache={});for(var v=n._gpuLinesCache,m=e({},t),h=t.uniforms||{},y=0,b=["vert","frag","debug","reorder","uniforms"];y<b.length;y++){delete m[b[y]]}if(Object.keys(m).forEach((function(n){if(q.has(n))throw new Error("Invalid parameter '".concat(n,"'. Parameters ").concat(o(q).map((function(n){return"'".concat(n,"'")})).join(",")," may not be forwarded to regl."))})),!a)throw new Error("Missing vertex shader,`vert`");if(!f)throw new Error("Missing fragment shader,`frag`");var g=O(a),C=k(g,n,!1),w=k(g,n,!0),A=[];p&&(v.debugInstanceIDBuffer||(v.debugInstanceIDBuffer=n.buffer(new Uint16Array(o(Array(V).keys())))),A.push({name:"debugInstanceID",spec:{buffer:v.debugInstanceIDBuffer,divisor:function(n,e){return e.instances}}})),v.indexBuffer||(v.indexBuffer=n.buffer(new Uint8Array(o(Array(4*J+6).keys())))),A.push({name:"index",spec:{buffer:v.indexBuffer,divisor:0}});var x=U("join",G,"miter"),B=U("cap",H,"square"),_=new Map;function E(e){return _.has(e)||_.set(e,N(n,e&W,e&F,e&K,g,f,C,w,A,m,h,p)),_.get(e)}var j=[];function I(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];j.push.apply(j,e)}function D(){d&&j.sort((function(n,e){return n.featureMask-e.featureMask}));for(var n=0,e=[];n<j.length;){var t=j[n],r=t.featureMask,o=t.props;for(e.push(o);++n<j.length&&j[n].featureMask===r;)e.push(j[n].props);E(r)(e),e.length=0}j.length=0}var T=function(n){if(n){Array.isArray(n)||(n=[n]);var t,r=s(n);try{for(r.s();!(t=r.n()).done;){var o=t.value,i=x(o.join),a=B(o.cap),c=!!o.vao,f=void 0===o.capResolution?12:o.capResolution;"square"===a?f=3:"none"===a&&(f=1);var u=1;"round"===i&&(u=void 0===o.joinResolution?8:o.joinResolution),f*=2,u*=2;var p="bevel"===i?1:void 0===o.miterLimit?4:o.miterLimit,l="square"===a?X:$,d=!!o.insertCaps,v={joinRes2:u,capRes2:f,capScale:l,join:i,miterLimit:p,insertCaps:d};if(o.endpointCount){var m=e(e({instances:1,count:o.endpointCount},o),v),h=Q(!0,d,c);if(c)if(g.orientation){var y={vao:m.vao.endpoints};I({featureMask:h,props:e(e({},m),y)})}else{var b={vao:m.vao.startCaps},C={vao:m.vao.endCaps};I({featureMask:h,props:e(e(e({},m),b),{},{orientation:z.CAP_START,splitCaps:!0})},{featureMask:h,props:e(e(e({},m),C),{},{orientation:z.CAP_END,splitCaps:!0})})}else m.buffers=M(g,o.endpointAttributes,!0),g.orientation?I({featureMask:h,props:e(e({},m),{},{splitCaps:!1})}):I({featureMask:h,props:e(e({},m),{},{orientation:z.CAP_START,splitCaps:!0})},{featureMask:h,props:e(e({},m),{},{orientation:z.CAP_END,splitCaps:!0})})}if(void 0===o.instances&&(o.instances=1),o.vertexCount){var w=Q(!1,d,c),A=e(e({count:o.vertexCount},o),v);c?A.vao=o.vao.vertices:A.buffers=M(g,o.vertexAttributes,!1),I({featureMask:w,props:A})}D()}}catch(n){r.e(n)}finally{r.f()}}};return T.vao=function(e){var t={},o=[["vertices",C.attrs,e.vertexAttributes,!1]];g.orientation?o.push(["endpoints",w.attrs,e.endpointAttributes,!0,!1,null]):o.push(["startCaps",w.attrs,e.endpointAttributes,!0,!0,z.CAP_START],["endCaps",w.attrs,e.endpointAttributes,!0,!0,z.CAP_END]);for(var i=0,a=o;i<a.length;i++){var c=r(a[i],6),f=c[0],u=c[1],p=c[2],l=c[3],d=c[4],v=c[5];if(p){var m,h={buffers:M(g,p,l),splitCaps:d,orientation:v},y=[],b=s(A.concat(u));try{for(b.s();!(m=b.n()).done;){for(var x=m.value,B={},_=0,E=["buffer","divisor","offset","stride","normalized","dimension"];_<E.length;_++){var j=E[_],I=x.spec[j];I&&I.data&&(I=I.data),"function"==typeof I&&(I=I({},h)),void 0!==I&&(B[j]=I)}y.push(B)}}catch(n){b.e(n)}finally{b.f()}t[f]=n.vao(y)}}return t.destroy=function(){for(var n=0,e=o;n<e.length;n++){var i=r(e[n],1)[0];t[i]&&(t[i].destroy(),delete t[i])}},t},T}return L}));